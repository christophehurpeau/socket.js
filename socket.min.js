/* socket.js v0.1.1 */
var socketjs=function(){"use strict";var e=function(e){try{if("string"!=typeof JSON.stringify(e))return!1}catch(t){return!1}return!0};return{isSupported:function(){return"undefined"!=typeof WebSocket},connect:function(t,n){if(void 0!==t&&"string"!=typeof t)throw"Invalid parameter: host";if(void 0!==n&&"boolean"!=typeof n)throw"Invalid parameter: secure";if(!socketjs.isSupported())throw"WebSockets are not supported";var o=void 0===n?"https:"===location.protocol.toLowerCase():n,r=(o?"wss://":"ws://")+(void 0===t?window.location.host:t)+"/",a=null,i=!1,c=!1,s={},l=null,f=null,u=null,p=[],d=function(e){var t=new WebSocket(e);return t.onopen=h,t.onmessage=v,t.onclose=y,t},h=function(){if(c){c=!1,p.length>0&&p.splice(0,p.length);var t=null;if(null!==f&&(t=f(),void 0===t&&(t=null),!e(t)))throw"Invalid reconnectData";p.push({type:"reconnect",reconnectData:t})}m()},v=function(e){var t=JSON.parse(e.data);"message"===t.type?void 0!==s[t.messageType]&&s[t.messageType](t.message):"close"===t.type&&g()},y=function(){if(!i){c||(c=!0,null!==l&&l());var e=setInterval(function(){if(!i)try{a=d(r)}catch(t){return}clearInterval(e)},2e3)}},m=function(){if(i||c)p.length>0&&p.splice(0,p.length);else if(a.readyState===WebSocket.OPEN){for(var e=0;e<p.length;e+=1)a.send(JSON.stringify(p[e]));e>0&&p.splice(0,e)}},g=function(){i||(i=!0,a.readyState!==WebSocket.CLOSING&&a.readyState!==WebSocket.CLOSED&&a.close(),null!==u&&u())};return a=d(r),p.push({type:"connect"}),m(),{send:function(t,n){if("string"!=typeof t)throw"Invalid parameter: type";if(!e(n))throw"Invalid parameter: message";if(i)throw"Attempted to transmit after the connection has been closed";c||(p.push({type:"message",messageType:t,message:n}),m())},receive:function(e,t){if("string"!=typeof e)throw"Invalid parameter: type";if(null!==t&&"function"!=typeof t)throw"Invalid parameter: handler";if(i)throw"Attempted to set message handler after the connection has been closed";null===t?delete s[e]:s[e]=t},disconnect:function(e){if(null!==e&&"function"!=typeof e)throw"Invalid parameter: handler";if(i)throw"Attempted to set disconnect handler after the connection has been closed";l=e},reconnect:function(e){if(null!==e&&"function"!=typeof e)throw"Invalid parameter: handler";if(i)throw"Attempted to set reconnect handler after the connection has been closed";f=e},close:function(e){if(void 0!==e&&null!==e&&"function"!=typeof e)throw"Invalid parameter: handler";void 0===e?g():u=e}}}}}();
